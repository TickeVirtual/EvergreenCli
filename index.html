<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket de Compra</title>
    <style>
      * {
        font-family: tahoma, Helvetica, sans-serif;
        font-size: 3mm !important;
        line-height: 1 !important;
      }

      .info-tienda {
        margin-top: 0;
        margin-bottom:0mm;
        line-height: 4mm;
      }

      .nro_boleta {
        margin: 0;
        font-size: 10mm !important;
      }

      .fecha_recepcion {
        margin: 0;
      }
      .fecha_entrega {
        line-height: 5mm;
        margin: 0;
      }

      .nombre-cliente {
        margin: 0mm;
        margin-top: 0;
        font-size: mm !important;
      }

      #thermal-pos {
        box-shadow: 0 0 5mm #eee;
        margin: 0 auto;
        max-width: 79mm;
        padding: 3mm;
      }

      #thermal-pos h2 {
        font-size: 2mm;
        line-height: 13px;
        font-weight: normal;
      }
      .label {
        margin: 0;
      }
      .ticket, .fecharecep {
        text-align: center;
        padding: 0;
      }

      #thermal-pos .label {
        text-align: center;
        font-size: 2mm;
      }
      #thermal-pos .line {
        text-align: center;
        line-height: 0;
        font-size: 1mm;
      }

      #thermal-pos .detalles {
        vertical-align: text-top;
        max-width: 35mm;
        word-wrap: break-word;
      }

      #thermal .listitem {
        font-size: 2mm;
        height: 5mm;
      }

      #thermal-pos table {
        font-size: 2mm;
        height: 5mm;
        border-collapse: collapse;
      }

      #thermal-pos .item {
        max-width: 30mm;
        font-size: 2.1mm;
        text-align: start;
        word-wrap: break-word;
        font-weight: normal;
      }

      #thermal-pos .cantidad {
        text-align: right;
      }

      #thermal-pos .footer {
        margin-top: 5mm;
        text-align: center;
        height: 60px;
        page-break-after: auto;
      }

      .table {
        width: 100%;
        text-align: right;
      }

      .table-header {
        text-align: right;
        border-top: groove;
        border-bottom: groove;
      }

      .table-header h2 {
        margin: 0;
      }

      .table-item {
        vertical-align: top;
      }

      .top-line {
        border-top: groove;
      }

      .pt-2 {
        padding-top: 2mm;
      }

      .saldo-text {
        margin: 0;
        font-size: 15mm;
        text-align: center;
      } 

      .table-footer {
        vertical-align: bottom;
        text-align: right;
        font-size: 2mm;
        line-height: 2mm;
      }

      .table-footer h2 {
        margin: 0;
        font-size: 2mm;
      }

      .estado-deuda {
        font-size: 8mm !important;
      }

      .info {
        font-size: 1.6mm;
      }
      .info p {
        padding-bottom: 0;
        margin-bottom: 0;
      }

      .align-left {
        text-align: left;
      }

      .m-0 {
        margin: 0 !important;
        text-align: left;
      }

      .policy {
        font-size: 1.5mm;
        line-height: 3.5mm;
        padding: 3mm;
        padding-top: 0;
      }

      .policy .policy-title {
        text-align: center;
        margin: 0;
        font-weight: normal;
      }

      .align-right {
        text-align: right;
      }

      .button-container {
        display: flex;
        justify-content: center;
      }

      .button-box {
        max-width: 300px;
        display: flex;
        justify-content: space-between;
      }

      .button-box img {
        max-width: 100%;
      }

      @media print {
        #whatsappButton,
        #impresoraButton {
          display: none;
        }

        img#whatsappButton,
        img#impresoraButton {
          display: none;
        }
      }

      .saludos {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .saludos img {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>

  <body>
    <div id="header">
      <div class="button-container">
        <div class="button-box">
          <a href="#" id="impresoraButton">
            <img class="boton" src="Print.png" class="ImganelLogo" width="60%" id="foto">
          </a>
          <a href="#" id="whatsappButton">
            <img class="boton" src="wsp.png" class="ImganelLogo" width="60%" id="foto">
          </a>
        </div>
      </div>
    </div>

    <div id="thermal-pos">
      <div class="label">
        <img class="boton" src="Evergreen.png" class="ImganelLogo" width="60%" id="foto">
        <br>
        <p class="info-tienda">
          Salaverry 193 , Miraflores
          <br>
          Telefono: 947947119
          <br>
          Horario de lunes a sábado de 9:00 am a 7:00 pm
          <br>
        </p>
      </div>
      <div class="ticket">
        <b>TICKET:<br>
        <h1 class="nro_boleta" id="nro_boleta_id"></h1>
      </div>
      <div class="fecharecep">
        <p class="fecha">
          <b>FECHA RECEPCION:<br>
          <b id="fecha"></b>
          <br>
          <b>CLIENTE:<br>
          <b id="nombre_client"></b>
        </p>
      </div>
      <div class="label">
        <p class="fecha_entrega">
          <b> FECHA ENTREGA: <br>
          <span id="fecha_entrega"></span>
          </b>
        </p>
      </div>

      <table class="table">
        <tbody id="tablaBody">
          <tr class="table-header">
            <th><h2>Cant</h2></th>
            <th><h2>Descripcion</h2></th>
            <th><h2>Precio</h2></th>
            <th><h2>Subtotal</h2></th>
          </tr>
        </tbody>
      </table>
      <br>
      <p class="saldo-text">
        <b><span class="estado-deuda" id="estado"></span></b>
      </p>
      <br>
      <div class="policy">
        <p class="policy-title">
          <b>Gracias por confiar en nosotros</b>
        </p>
      </div>

      <div class="saludos">
        <img id="fiestas" src="fiestas.png" alt="FIESTAS" width="60%">
        <img id="navidad" src="navidad.png" alt="NAVIDAD" width="60%">
      </div>
    </div>

    <script>
      // Obtener los parámetros de la URL
      const params = new URLSearchParams(window.location.search);

      // Obtener los valores de los parámetros
      var nro_boleta = params.has('boleta') ? params.get('boleta') : "---";
      var nombre_cliente = params.has('cliente') ? params.get('cliente') : "==Cliente==";
      var telefono = params.has('telefono') ? params.get('telefono') : "==Cliente==";
      var codigo_pais = params.has('codigo_pais') ? params.get('codigo_pais') : "==Cliente==";
      var fecha = params.has('fecha') ? params.get('fecha') : "dd/mm/aaaa hh:mm:ss";
      var fecha_entrega = params.has('fecha_entrega') ? params.get('fecha_entrega') : "hh:mm:ss";
      var total = params.has('total') ? params.get('total') : "";
      var subtotal_desc = params.has('subtotal_desc') ? params.get('subtotal_desc') : " ";
      var total_a_pagar = params.has('total_a_pagar') ? params.get('total_a_pagar') : "";
      var deuda_total = params.has('deuda_total') ? params.get('deuda_total') : "";
      var estado = params.has('estado') ? params.get('estado') : "ABONADO";

      // Asignar los valores a los elementos HTML correspondientes
      document.getElementById('nro_boleta_id').textContent = nro_boleta;
      document.getElementById('nombre_client').textContent = nombre_cliente;
      document.getElementById('telefono').textContent = telefono;
      document.getElementById('fecha').textContent = fecha;
      document.getElementById('fecha_entrega').textContent = fecha_entrega;
      document.getElementById('estado').textContent = estado;

      var miArray = [];
      // Código que usa la variable
      if (params.has('items')) {
        miArray = JSON.parse(params.get('items'));
      }

      var tablaBody = document.getElementById('tablaBody');

      // Recorrer el array y agregar los elementos a la tabla
      for (var i = 0; i < miArray.length; i++) {
        var item = miArray[i];

        var fila = document.createElement('tr');
        fila.classList.add('listitem');
        fila.innerHTML = '<td class="cantidad"><h2>' + item.cantidad + '</h2></td>' +
                         '<td class="item"><h2>' + item.descripcion + '</h2></td>' +
                         '<td class="align-right"><h2>' + item.precio + '</h2></td>' +
                         '<td class="align-right"><h2>' + item.subtotal + '</h2></td>';

        tablaBody.appendChild(fila);
      }

      // Insertar la última fila con los totales
      var filaTotales = document.createElement('tr');
      filaTotales.innerHTML = '<td colspan="2"></td>' +
                              '<td class="align-right top-line"><h2>Total</h2></td>' +
                              '<td class="align-right top-line"><h2>' + total + '</h2></td>';

      tablaBody.appendChild(filaTotales);

      // Insertar la fila de subtotal descuento si está disponible
      if (subtotal_desc.trim() !== '') {
        var filaSubtotalDesc = document.createElement('tr');
        filaSubtotalDesc.innerHTML = '<td colspan="2"></td>' +
                                     '<td class="align-right top-line"><h2>Subtotal</h2></td>' +
                                     '<td class="align-right top-line"><h2>' + subtotal_desc + '</h2></td>';

        tablaBody.appendChild(filaSubtotalDesc);
      }

      // Insertar la fila de total a pagar si está disponible
      if (total_a_pagar.trim() !== '') {
        var filaTotalAPagar = document.createElement('tr');
        filaTotalAPagar.innerHTML = '<td colspan="2"></td>' +
                                    '<td class="align-right top-line"><h2>Total a Pagar</h2></td>' +
                                    '<td class="align-right top-line"><h2>' + total_a_pagar + '</h2></td>';

        tablaBody.appendChild(filaTotalAPagar);
      }

      // Insertar la fila de deuda total si está disponible
      if (deuda_total.trim() !== '') {
        var filaDeudaTotal = document.createElement('tr');
        filaDeudaTotal.innerHTML = '<td colspan="2"></td>' +
                                   '<td class="align-right top-line"><h2>Deuda Total</h2></td>' +
                                   '<td class="align-right top-line"><h2>' + deuda_total + '</h2></td>';

        tablaBody.appendChild(filaDeudaTotal);
      }
    </script>
  </body>
</html>
