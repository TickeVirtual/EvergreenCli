<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket de Compra</title>
    <style>
        * {
            font-family: tahoma, Helvetica, sans-serif;
            font-size: 3mm !important;
            line-height: 1 !important;
        }
        
        .info-tienda, .fecha_recepcion, .fecha_entrega, .nombre-cliente {
            margin: 0;
        }
        
        .nro_boleta {
            margin: 0;
            font-size: 10mm !important;
        }
        
        .fecha_entrega {
            line-height: 5mm;
        }
        
        #thermal-pos {
            box-shadow: 0 0 5mm #eee;
            margin: 0 auto;
            max-width: 79mm;
            padding: 3mm;
            text-align: center;
        }
        
        #thermal-pos h2, .label {
            font-size: 2mm;
            line-height: 13px;
            font-weight: normal;
            text-align: center;
            margin: 0;
        }
        
        .ticket, .fecharecep {
            text-align: center;
            padding: 0;
        }
        
        .table {
            width: 100%;
            text-align: right;
            border-collapse: collapse;
        }
        
        .table-header {
            border-top: groove;
            border-bottom: groove;
        }
        
        .table-item {
            vertical-align: top;
        }
        
        .top-line {
            border-top: groove;
        }
        
        .saldo-text {
            margin: 0;
            font-size: 15mm;
            text-align: center;
        }
        
        .estado-deuda {
            font-size: 8mm !important;
        }
        
        .policy {
            font-size: 1.5mm;
            line-height: 3.5mm;
            padding: 3mm 3mm 0;
        }

        .saludo {
            text-align: center;
        }

        .saludo img {
            display: block;
            margin: 0 auto;
        }

        
        
        .button-container {
            display: flex;
            justify-content: center;
            
        }
        
        .button-box {
            max-width: 300px;
            display: flex;
            justify-content: space-between;
        }
        
        .button-box img {
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }
        
        @media print {
            #whatsappButton, #impresoraButton {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="button-container">
        <div class="button-box">
            <a href="#" id="impresoraButton">
                <img src="Print.png" alt="Imprimir" width="60%">
            </a>
            <a href="#" id="whatsappButton">
                <img src="wsp.png" alt="WhatsApp" width="60%">
            </a>
        </div>
    </div>

    <div id="thermal-pos">
        <div class="label">
            <img src="Evergreen.png" alt="Logo Evergreen" width="60%">
            <p class="info-tienda">
                Salaverry 193 , Miraflores<br>
                Telefono: 947947119<br>
                Horario de lunes a s√°bado de 9:00 am a 7:0000 pm
            </p>
        </div>

        <div class="ticket">
            <b>TICKET:<br>
            <h1 class="nro_boleta" id="nro_boleta_id"></h1>
        </div>
        
        <div class="fecharecep">
            <p class="fecha">
                <b>FECHA RECEPCION:<br>
                <span id="fecha"></span></b>
            <br>
            <b>CLIENTE:<br>
            <span id="nombre_client"></span></b>
        </div>

        <div class="label">
            <p class="fecha_entrega">
                <b>FECHA ENTREGA:<br>
                <span id="fecha_entrega"></span></b>
            </p>
        </div>

        <table class="table">
            <thead>
                <tr class="table-header">
                    <th><h2>Cant</h2></th>
                    <th><h2>Descripcion</h2></th>
                    <th><h2>Precio</h2></th>
                    <th><h2>Subtotal</h2></th>
                </tr>
            </thead>
            <tbody id="tablaBody"></tbody>
            <tfoot>
                <tr class="table-footer top-line">
                    <td colspan="3">Total Venta:</td>
                    <td><h2 id="total"></h2></td>
                </tr>


                <tr class="table-footer">
                    <td colspan="3"><h2>A cuenta :</h2></td>
                    <td><h2 id="a_cuenta"></h2></td>
                </tr>
                <tr class="table-footer">
                    <td colspan="3"><h2>A cuenta 2:</h2></td>
                    <td><h2 id="a_cuenta_dos"></h2></td>
                </tr>


                <tr class="table-footer">
                    <td colspan="3"><h2>Total por pagar:</h2></td>
                    <td><h2 id="total_por_pagar"></h2></td>
                </tr>
            </tfoot>
        </table>

        <p class="saldo-text">
            <b><span class="estado-deuda" id="estado"></span></b>
        </p>

        <div class="policy">
            <p class="policy-title">
                <b>Gracias por confiar en nosotros</b>
            </p>
        </div>

        <div class="saludo">
            <img id="fiestas" src="fiestas.png" alt="FIESTAS" width="60%" style="display:none;">
            <img id="navidad" src="navidad.png" alt="NAVIDAD" width="60%" style="display:none;">
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);

        function getUrlParam(name, defaultValue) {
            return params.has(name) ? params.get(name) : defaultValue;
        }

        const nro_boleta = getUrlParam('boleta', '---');
        const nombre_cliente = getUrlParam('cliente', '==Cliente==');
        const telefono = getUrlParam('telefono', '==Cliente==');
        const codigo_pais = getUrlParam('codigo_pais', '==Cliente==');
        const fecha = getUrlParam('fecha', 'dd/mm/aaaa hh:mm:ss');
        const fecha_entrega = getUrlParam('fecha_entrega', 'hh:mm:ss');
        const total = getUrlParam('total', '');
        const a_cuenta = getUrlParam('a_cuenta', ' ');
        const a_cuenta_dos = getUrlParam('a_cuenta_dos', ' ');
        const total_por_pagar = getUrlParam('total_por_pagar', ' ');
        const estado = getUrlParam('estado', '--');

        const cantidades = getUrlParam('cantidades', '').split(',');
        const descripciones = getUrlParam('servicios', '').split(',');
        const detalle = getUrlParam('detalles', '').split(',');
        const p_units = getUrlParam('p_unit', '').split(',');

        const result = cantidades.map((cantidad, id) => ({
            cantidad,
            descripcion: descripciones[id],
            detalle: detalle[id],
            subtotal: (cantidad * parseFloat(p_units[id])).toFixed(2),
            precio_unit: parseFloat(p_units[id]).toFixed(2)
        }));

        const tablaBody = document.getElementById("tablaBody");
        result.forEach(row => {
            const newRow = document.createElement("tr");
            newRow.className = "table-item";
            newRow.innerHTML = `
                <td class="item" style="text-align: right;">${row.cantidad}</td>
                <td class="item" style="text-align: right;">${row.descripcion}</td>
                <td class="item" style="text-align: right;">${row.precio_unit}</td>
                <td class="item" style="text-align: right;">${row.subtotal}</td>
            `;
            tablaBody.appendChild(newRow);
        });

        function sendWhatsAppMessage() {
            const currentURL = window.location.href;
            const message = `Hola!! somos de la lavander√≠a, somos una lavander√≠a que cuida el medio ambiente ‚ôªÔ∏è‚ôªÔ∏è‚ôªÔ∏è‚ôªÔ∏è‚ôªÔ∏è, por ello adjuntamos su ticket de atenci√≥n virtual. Click en el link para ver el ticket üëáüèªüëáüèªüëáüèª ${currentURL}`;
            const whatsappLink = `https://api.whatsapp.com/send?phone=${codigo_pais}${telefono}&text=${encodeURIComponent(message)}?sharelink=1`;
            window.open(whatsappLink, '_blank');
        }

        document.getElementById('whatsappButton').addEventListener('click', sendWhatsAppMessage);

        function printTicket() {
            window.print();
        }

        document.getElementById('impresoraButton').addEventListener('click', printTicket);

        function setElementContent(id, content) {
            document.getElementById(id).textContent = content;
        }

        setElementContent("nro_boleta_id", nro_boleta);
        setElementContent("fecha", fecha);
        setElementContent("nombre_client", nombre_cliente);
        setElementContent("fecha_entrega", fecha_entrega);
        setElementContent("total", total);
        setElementContent("a_cuenta", a_cuenta);
        setElementContent("a_cuenta_dos", a_cuenta_dos);
        setElementContent("total_por_pagar", total_por_pagar);
        setElementContent("estado", estado);

        function estaEnRango(inicio, fin) {
            const [inicioDia, inicioMes] = inicio.split('-').map(Number);
            const [finDia, finMes] = fin.split('-').map(Number);
            
            const hoy = new Date();
            const hoyMesDia = new Date(0, hoy.getMonth(), hoy.getDate());
            const inicioMesDia = new Date(0, inicioMes - 1, inicioDia);
            const finMesDia = new Date(0, finMes - 1, finDia);
            
            return hoyMesDia >= inicioMesDia && hoyMesDia <= finMesDia;
        }

        if (estaEnRango('16-07', '16-07')) {
            document.getElementById('fiestas').style.display = 'block';
        } else if (estaEnRango('15-07', '15-07')) {
            document.getElementById('navidad').style.display = 'block';
        }

        const currentURL = window.location.href;
        if (currentURL.indexOf('sharelink=1') !== -1) {
            document.getElementById('whatsappButton').style.display = 'none';
            document.getElementById('impresoraButton').style.display = 'none';
        }
    </script>
</body>
</html>
